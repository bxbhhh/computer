## 冲突处理与异常和中断

* MIPS计算机硬件系统组成：存储器、寄存器堆、ALU、控制部件

* 五段流水的划分：

  * 取指令周期IF

  * 指令译码/读寄存器周期ID

  * 执行/有效地址计算周期EX

  * 存储器访问/分支完成周期MEM

  * 写回周期WB

* 三个冲突：

  * 结构冲突：指令在重叠执行的过程中，硬件资源满足不了指令重叠执行的要求，发生硬件资源冲突而产生的冲突。

    * 参考解决办法：暂停流水线，插入等待周期；增加资源，解决资源冲突
    * 解决存储器争用冲突的方法：数据指令分开存储；数据指令用同一存储器的两个端口
    * 已经发现的问题
      * 寄存器堆的读写要求如果同时到来，应该怎么样才能保证读出的是正确的值？
        * 考虑读出要求的时效性，写入要求的稳定性
        * 所以，写入应该为读出服务，如果当前正要写入和读出的是一个地址，那么，就直接把要写入的值，传给读出的接口。（选择器实现），然后写入的过程照常写入。

  * 数据冲突：在同时重叠执行的几条指令中，一条指令依赖于前面指令执行结果数据，但是又在指令格式所指定的位置得不到时发生的冲突。

  * 控制冲突：流水线中分支指令或者其他需要改写PC的指令造成的冲突。

    ### 异常处理的初步思路

    ​	每次有外设中断信号或者异常发生时，先保存异常的编号（在中断控制单元中），然后跳转到保存现场的代码，保存结束之后回到中断控制单元控制下，根据异常的编号继续跳转到异常处理的代码，执行完异常处理的代码之后，恢复现场。